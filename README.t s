// 注入 JavaScript 捕获网络请求时间
var script = 
    "var performance = window.performance || window.msPerformance || window.webkitPerformance || {}; " +
    "var entries = performance.getEntries() || []; " +
    "return entries.map(entry => ({ " +
    "    name: entry.name, " +
    "    duration: entry.duration, " +
    "    entryType: entry.entryType " +
    "}));";

var response = WDS.browser.executeScript(script);

// 记录所有性能条目
WDS.log.info("All Performance Entries: " + JSON.stringify(response));

// 过滤和记录请求时间
var totalDuration = 0;
if (response && response.length) {
    var filteredEntries = response.filter(entry => entry.name.includes('api/endpoint'));
    WDS.log.info("Filtered Entries: " + JSON.stringify(filteredEntries));
    if (filteredEntries.length > 0) {
        filteredEntries.forEach(function(entry) {
            totalDuration += entry.duration;
        });
    } else {
        WDS.log.info("No matching entries found after filtering.");
    }
} else {
    WDS.log.info("No performance entries found.");
}

// 打印 totalDuration 到日志
WDS.log.info("Total Duration: " + totalDuration + "ms");
